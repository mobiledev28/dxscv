@using SCVData;

@model DXSCV.Models.MantenimientoViewModel
@{
    ViewBag.Title = "Mantenimientos";
    Layout = "~/Views/Shared/_mainLayout.cshtml";
}

<script type="text/javascript">

    function TipoDocSelected(s, e) {
        var value = s.GetValue();//document.getElementById("cmbTipoDocumento");
        $("#hdnTipoDoc").val(value);
        //alert(value);
    }
    function OnClick(s, e) {
        var tipodoc = $("#hdnTipoDoc").val();

        //El tipo de documento es requerido
        if (tipoc == "0") {
            alert("No se cargo el documento, debes seleccionar el tipo de documento.");
            return;
        }

        uc.Upload();
    }

    function OnFileUploadComplete(s, e) {
        if (e.callbackData !== "") {
            var tipodoc = $("#hdnTipoDoc").val();
            //El tipo de documento el requerido
            if (tipodoc == "0") {
                return;
            }

            var mantenimientoId = $("#hdMantenimientoId").val();
            var url = e.callbackData;

            UploadEvents.SaveInfoFile(mantenimientoId, url, '/Mantenimiento/AddInfoFile', tipodoc);
        } else {
            alert("El archivo no pudo ser cargado.");
        }
    }

    //Show popup for updload documents
    var currentmantenimientoId;
    function OnHyperLinkClick(id) {
        currentmantenimientoId = id;
        $("#hdMantenimientoId").val(id);

        UploadEvents.GetFiles(currentmantenimientoId, '/Mantenimiento/GetFiles', 5);

        if (!popup.IsVisible()) {
            popup.Show();
        }
    }

    function GeneraOM(id) {
        currentmantenimientoId = id;
        $("#hdMantenimientoId").val(id);
        window.location = 'ExportPDF/' + id;
    }

    function OnDetailGridBeginCallback(s, e) {
        e.customArgs["_mantenimientoId"] = currentmantenimientoId;
    }

    function OnDetailGridEndCallback(s, e) {

        if (!popup.IsVisible()) {
            popup.Show();
        }
    }

    function testPDF() {
        $.ajax({
            beforeSend: function () {
                $('.loading').show();
            },
            complete: function () {
                $('.loading').hide();
            },
            url: '/Mantenimiento/PrintPDF',
            type: 'GET',
            dataType: 'json',
            data: {
                id : "0"
            },
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                //UploadEvents.AddInfoFileSection(data, data.modulo);
            },
            error: function () {
                alert("error");
            }
        });
    }


</script>



<div style="width:100%;position:relative;margin-bottom:10px;margin-top:10px;font-size:2em;">Mantenimientos</div>
@*<div><button id="btntest" onclick="testPDF();">Export to PDF</button>@Html.ActionLink("Export To PDF", "ExportPDF", "Mantenimiento")</div>*@
@Html.Partial("GridViewPartialView", Model)
@Html.Hidden("hdMantenimientoId")


@Html.DevExpress().PopupControl(settings =>
{
    settings.Name = "popup";
    settings.PopupVerticalAlign = PopupVerticalAlign.WindowCenter;
    settings.PopupHorizontalAlign = PopupHorizontalAlign.WindowCenter;
    settings.Width = System.Web.UI.WebControls.Unit.Pixel(360);
    settings.Height = System.Web.UI.WebControls.Unit.Pixel(170);
    settings.HeaderText = "Carga de Documentos";
    settings.SetContent(() =>
    {
        Html.RenderPartial("LoadDocumentsPartialView", Model);
    });

}).GetHtml()

